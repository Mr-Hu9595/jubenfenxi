# 使用手册（剧本分析系统）

## 功能概览
- 批量解析 `txt/docx` 剧本文本；`pdf` 解析失败时提示上传文本版本。
- 依据规则文档计算：内容（剧情结构/角色塑造/冲突设置/台词质量）、人物饱满度（四组件加权）、制作（场景/演员）、宣发（受众/上线时间/营销方向）、商业价值指数。
- 结果写入 Excel（工作表1），并按列应用公式计算总分与等级。

## 网页使用
- 启动：`python tools/web_app.py`。
- 访问首页上传文件，支持一次选择多个 `txt/docx/pdf`。
- 上传后自动解析并写入当前会话的 Excel（默认工作目录下 `剧本评估表.xlsx`，可通过环境变量 `EXCEL_PATH` 覆盖），可在页面预览或下载。
- 若为 `pdf` 且解析失败，系统会在结果中标注，请改用可解析文本版本。

## 指标说明
- 人物饱满度：四组件（关键词/连接词/反差词对/事件层级与弧光）按 40/30/20/10 加权形成 0–100 指数；标签为“高/中/低”。
- 总分：内容四项（50）+ 人物饱满度（20，通过 AQ/100*20 折算）+ 制作（15）+ 宣发（10）+ 商业价值（5）。
- 评分等级：极弱/偏弱/中等/较强/卓越（区间映射）。

## 常见问题
- `pdf` 提取失败：请转为 `docx` 或 `txt` 再上传。
- 标题或文本缺失：系统会做合理推断并在备注标注假设来源。
- 反转过密：逻辑不自洽或无代价会扣减结构与冲突评分。

## 命令行批处理（可选）
- 推荐使用通用入口：`python tools/universal_cli.py --input <目录或文件> --excel "/Users/mr.hu/Desktop/爆款排名/剧本评估表.xlsx" --sheet "工作表1"`。支持 `txt/docx/pdf`；若 `pdf` 解析失败会提示改用文本版本。
- 历史示例：`tools/legacy/analyze_scripts.py` 面向特定数据集（如 `10.31剧本_txt`），保留为参考，不建议作为通用入口。

## Excel 字段说明与列含义（工作表：工作表1/评估输入）
- 基础字段（A–G）
  - `A` 序号：手填或自动编号。
  - `B` 剧本名：可由文本首行推断并填充。
  - `C` 文本/URL：本地 `txt/docx` 路径或 HTTP 直链。
  - `D` 文本粘贴：粘贴全文正文（≥50 字优先）。
  - `E` 字数(千字)：自动统计，含中文标点（不含样式/图片）。
  - `F` 页数：粗估，按 1200 字≈1 页。
  - `G` 建议集数区间：`IF(E<=8,"15–20集",IF(E<=20,"20–30集","30–40集"))`。

- 基础识别与建议（H–K、N–P、BH）
  - `H` 倾向：男频/女频/双频，基于文本关键词与叙事侧重自动识别。
  - `I` 时代背景：现代/古代/民国/科幻/其他，自动识别并标准化映射。
  - `J` 主题：题材标签（都市/家庭/职场/武侠/悬疑/复仇/甜宠/系统/重生/...）。
  - `K` 导演（风格建议）：商业爽剧/写实都市/古装群像/武侠动作/悬疑快剪等。
  - `N` 受众定位（标签）：年龄段与圈层建议（如下沉/一二线、45+/18–35、男/女）。
  - `O` 上线时间（推荐窗口）：工作日晚间/周末黄金/节假日前后。
  - `P` 营销方向：反转爽点/成长救赎/甜虐情绪/知识信息量/家国叙事。
  - `BH` 平台推荐：结合倾向/时代与舆情偏好给出平台建议。

- 冲突设置（Q–T）与综合分（AI）
  - `Q` 类型覆盖（0–3）：人-人/人-环境/人-自我至少覆盖两类得 3。
  - `R` 升级曲线（0–3）：强度递增≥3 阶得 3。
  - `S` 风险与代价（0–3）：出现高风险词并兑现代价得 3。
  - `T` 解决策略多样性（0/1）：方案≥2 且非“神降解题”得 1。
  - `AI` 冲突设置总分：`Q+R+S+T`（权重 10）。

- 台词质量（U、V、W、X、AJ、AK、AL）
  - `U` 信息密度（0–3）：每 100 字有效信息点≥1.5 得 3。
  - `V` 金句率与记忆点（0–2）：每千字≥2 句且不浮夸得 2。
  - `W` 生活化/专业度（0/1）：常识与术语准确得 1。
  - `X` 价值观与合规（0/1）：无不当话术与尺度得 1。
  - `AJ` 人设匹配（0–3）：语体一致、口吻贴合得 3。
  - `AK` 信息密度副本：与 `U` 一致，用于视图/汇总。
  - `AL` 台词质量总分：`AJ+U+V+W+X`（权重 10）。

- 剧情结构（Y、Z、AA、AB、AC）
  - `Y` 起承转合完整度（0–6）：出现≥5 个标志词得 ≥5，4 个得 4，≤3 取≤3。
  - `Z` 转折密度（0–4）：每 4k–6k 字至少 1 次关键反转，密度达标得 4。
  - `AA` 悬念闭合率（0–3）：回收比例≥0.8 得 3；0.6–0.79 得 2；<0.6 得 ≤1。
  - `AB` 节奏均衡度（0–2）：场景长度方差适中、段落节拍稳定得 2。
  - `AC` 剧情结构总分：`Y+Z+AA+AB`（权重 15）。

- 角色塑造（AD、AE、AF、AG、AH）
  - `AD` 目标-动机-障碍（0–5）：主角与关键反派均完整得 5。
  - `AE` 弧光与反差（0–6）：关键词与连接词共现频高、阶段变化明确得 4–6。
  - `AF` 关系网复杂度（0–3）：关键关系≥4 条、关系变化≥2 次得 3。
  - `AG` 记忆点（0/1）：昵称/口头禅/独特行为≥2 得 1。
  - `AH` 角色塑造总分：`AD+AE+AF+AG`（权重 15）。

- 人物饱满度（AM、AN、AO、AP、AQ、AR）
  - `AM` 关键词权重（0–100）：反转/黑化/洗白/救赎/成长/挣扎/人性频次，千字标准化。
  - `AN` 连接词权重（0–100）：但是/然而/一方面/另一方面/看似/实则/表面/内心共现强度。
  - `AO` 反差词对（0–100）：正/反面特质同现并与事件绑定（如“温柔/暴烈”）。
  - `AP` 事件层级与弧光（0–100）：阶段性变化≥3 次、与关键节点挂钩。
  - `AQ` 人物饱满度指数：`ROUND(AM*0.4 + AN*0.3 + AO*0.2 + AP*0.1,2)`；标签高/中/低见 `AR`。
  - `AR` 人物饱满度标签：`IF(AQ>=67,"高",IF(AQ>=34,"中","低"))`。

- 制作（L、M、AS）
  - `L` 场景数量分（0–8）：以地点更换/转场标记/情节段落统计，内景比例更优。
  - `M` 演员数量结构分（0–7）：核心角色 4–8 最优；群演≈核心×0.6 为基线。
  - `AS` 制作总分：`MIN(15, L+M)`（权重 15）。

- 宣发（AT、AU、AV、AW）
  - `AT` 受众定位分（0–4）：题材与弧光匹配细分标签。
  - `AU` 上线时间分（0–3）：窗口选择与平台热度及竞品排期。
  - `AV` 营销方向分（0–3）：反转/成长/甜虐/知识/家国，素材策略明确。
  - `AW` 宣发总分：`MIN(10, AT+AU+AV)`（权重 10）。

- 商业价值（AX、AY、AZ、BA、BB）
  - `AX` 题材热度（0–2）：近 1–3 月平台与公开报道。
  - `AY` 传播因子（0–1.5）：反转密度、情绪强度、共鸣点、话题词可制作性。
  - `AZ` 可生产性（0–1）：场景/演员/内外景比例→成本可控度。
  - `BA` 合规风险（0–0.5）：价值观与尺度安全。
  - `BB` 商业价值指数（0–100）：`ROUND((AX/2*0.4 + AY/1.5*0.3 + AZ/1*0.2 + BA/0.5*0.1)*100,2)`。

- 汇总（BC、BD）
  - `BC` 总分（0–100）：`AC+AH+AI+AL+(AQ/100*20)+AS+AW+(BB/100*5)`。
  - `BD` 评分等级：区间映射 `极弱/偏弱/中等/较强/卓越`。

备注与口径：
- 字数与页数按纯文本统计，`docx` 转文本后去除样式；千字为单位。
- 若关键信息缺失，系统将合理推断并在备注（或文本列）中标注假设来源。
- 平台舆情引用口径：重点参考红果近 1–3 个月数据与公开报道，同时对齐抖音/快手/小红书偏好；免费+广告分成模式下，反转与成长/救赎更易传播。